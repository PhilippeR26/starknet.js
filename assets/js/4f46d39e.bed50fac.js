"use strict";(self.webpackChunkwww=self.webpackChunkwww||[]).push([[60423],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>h});var a=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},c=Object.keys(e);for(a=0;a<c.length;a++)n=c[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(a=0;a<c.length;a++)n=c[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=a.createContext({}),i=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},d=function(e){var t=i(e.components);return a.createElement(l.Provider,{value:t},e.children)},p="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},y=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,c=e.originalType,l=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),p=i(n),y=o,h=p["".concat(l,".").concat(y)]||p[y]||u[y]||c;return n?a.createElement(h,r(r({ref:t},d),{},{components:n})):a.createElement(h,r({ref:t},d))}));function h(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var c=n.length,r=new Array(c);r[0]=y;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[p]="string"==typeof e?e:o,r[1]=s;for(var i=2;i<c;i++)r[i]=n[i];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}y.displayName="MDXCreateElement"},58138:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>r,default:()=>u,frontMatter:()=>c,metadata:()=>s,toc:()=>i});var a=n(87462),o=(n(67294),n(3905));const c={sidebar_position:7},r="Create new contract",s={unversionedId:"guides/create_contract",id:"version-4.22.0/guides/create_contract",title:"Create new contract",description:"When you have compiled your new Cairo contract, you can deploy it in the network.",source:"@site/versioned_docs/version-4.22.0/guides/create_contract.md",sourceDirName:"guides",slug:"/guides/create_contract",permalink:"/starknet.js/docs/4.22.0/guides/create_contract",draft:!1,tags:[],version:"4.22.0",sidebarPosition:7,frontMatter:{sidebar_position:7},sidebar:"tutorialSidebar",previous:{title:"Interact with your contract",permalink:"/starknet.js/docs/4.22.0/guides/interact"},next:{title:"Create account",permalink:"/starknet.js/docs/4.22.0/guides/create_account"}},l={},i=[{value:"Class Hash \ud83d\ude15",id:"class-hash-",level:2},{value:"<code>declareDeploy()</code> your new contract",id:"declaredeploy-your-new-contract",level:2},{value:"<code>deployContract()</code> for a new instance",id:"deploycontract-for-a-new-instance",level:2},{value:"<code>declare()</code> for a new class",id:"declare-for-a-new-class",level:2}],d={toc:i},p="wrapper";function u(e){let{components:t,...c}=e;return(0,o.kt)(p,(0,a.Z)({},d,c,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"create-new-contract"},"Create new contract"),(0,o.kt)("p",null,"When you have compiled your new Cairo contract, you can deploy it in the network."),(0,o.kt)("p",null,"In Starknet, a new contract has to be added in two phases:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Create the contract class."),(0,o.kt)("li",{parentName:"ol"},"Deploy an instance of the contract.")),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"You must first declare your contract class and only then deploy a new instance of it!")),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(99357).Z,width:"939",height:"741"})),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"Both declaration and deployment will cost fees. That's why these functions are methods of the ",(0,o.kt)("inlineCode",{parentName:"p"},"Account")," object. The account should be funded enough to be able to process everything.")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"The contract class contains the logic of the contract. A contract class is identified by its Class Hash."),(0,o.kt)("li",{parentName:"ul"},"The contract instance contains the memory storage of this instance. A contract instance is identified by its contract address. You will interact with the contract instance by using this address.")),(0,o.kt)("p",null,"You will have only one Class Hash for the contract code, but you can have as many contract instances as you need."),(0,o.kt)("p",null,"Other users of the network can use your declared contract. It means that if somebody has already declared a contract class (and paid this declaration), and if you would like to have your own instance of this contract, you have only to deploy (and pay) a new instance."),(0,o.kt)("p",null,"Example: if you want an ERC20 contract, and somebody has already declared an ERC20 contract that conforms to your needs, you have just to deploy a new instance of this contract class."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-typescript"},'import { Provider, Account, Contract, ec, json, stark, uint256, shortString } from "starknet";\n')),(0,o.kt)("h2",{id:"class-hash-"},"Class Hash \ud83d\ude15"),(0,o.kt)("p",null,"TLDR: Starknet.js is not (yet) able to calculate a Class Hash \ud83d\ude2e."),(0,o.kt)("p",null,"The Class Hash should be a result of the compilation, but today, it's not recorded in the compiled file. It could be calculated during the declaration activity, but it's actually too long to process."),(0,o.kt)("p",null,"So you need to calculate yourself the Class hash, and add it as constant in your code."),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"You can calculate it with some other tool, for example: ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/xJonathanLEI/starkli"},"Starkli"))),(0,o.kt)("h2",{id:"declaredeploy-your-new-contract"},(0,o.kt)("inlineCode",{parentName:"h2"},"declareDeploy()")," your new contract"),(0,o.kt)("p",null,"Starknet.js proposes a function to perform both operations in one step: ",(0,o.kt)("inlineCode",{parentName:"p"},"declareDeploy()"),"."),(0,o.kt)("p",null,"Here, to declare & deploy a ",(0,o.kt)("inlineCode",{parentName:"p"},"Test.cairo")," smartcontract, in Testnet 1:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-typescript"},'// connect provider\nconst provider = new Provider({ sequencer: { network: "goerli-alpha" } });\n// connect your account. To adapt to your own account:\nconst privateKey0 = process.env.OZ_ACCOUNT_PRIVATE_KEY;\nconst account0Address: string = "0x123....789";\n\nconst starkKeyPair0 = ec.getKeyPair(privateKey0);\nconst account0 = new Account(provider, account0Address, starkKeyPair0);\n\n// Declare & deploy Test contract in devnet\n// ClassHash has been calculated previously with specific tool\nconst testClassHash = "0xff0378becffa6ad51c67ac968948dbbd110b8a8550397cf17866afebc6c17d";\nconst compiledTest = json.parse(fs.readFileSync("./compiled_contracts/test.json").toString("ascii"));\nconst deployResponse = await account0.declareDeploy({ contract: compiledTest, classHash: testClassHash });\n\n// Connect the new contract instance:\nconst myTestContract = new Contract(compiledTest.abi, deployResponse.deploy.contract_address, provider);\nconsole.log(\'\u2705 Test Contract connected at =\', myTestContract.address);\n')),(0,o.kt)("h2",{id:"deploycontract-for-a-new-instance"},(0,o.kt)("inlineCode",{parentName:"h2"},"deployContract()")," for a new instance"),(0,o.kt)("p",null,"If the contract class is already deployed, it's faster and cheaper to use ",(0,o.kt)("inlineCode",{parentName:"p"},"deployContract()"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-typescript"},'// connect provider\nconst provider = new Provider({ sequencer: { network: "goerli-alpha" } });\n// connect your account. To adapt to your own account:\nconst privateKey0 = process.env.OZ_ACCOUNT_PRIVATE_KEY;\nconst account0Address: string = "0x123....789";\n\nconst starkKeyPair0 = ec.getKeyPair(privateKey0);\nconst account0 = new Account(provider, account0Address, starkKeyPair0);\n\n// Deploy Test contract in devnet\n// ClassHash has been calculated previously with specific tool\nconst testClassHash = "0xff0378becffa6ad51c67ac968948dbbd110b8a8550397cf17866afebc6c17d";\nconst deployResponse = await account0.deployContract({ classHash: testClassHash });\n\n// read abi of Test contract\nconst { abi: testAbi } = await provider.getClassAt(deployResponse.contract_address);\nif (testAbi === undefined) { throw new Error("no abi.") };\n\n// Connect the new contract instance:\nconst myTestContract = new Contract(testAbi, deployResponse.contract_address, provider);\nconsole.log(\'\u2705 Test Contract connected at =\', myTestContract.address);\n')),(0,o.kt)("h2",{id:"declare-for-a-new-class"},(0,o.kt)("inlineCode",{parentName:"h2"},"declare()")," for a new class"),(0,o.kt)("p",null,"If you want only declare a new Contract Class, use ",(0,o.kt)("inlineCode",{parentName:"p"},"declare()"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-typescript"},'// connect provider\nconst provider = new Provider({ sequencer: { network: "goerli-alpha" } });\n// connect your account. To adapt to your own account:\nconst privateKey0 = process.env.OZ_ACCOUNT_PRIVATE_KEY;\nconst account0Address: string = "0x123....789";\n\nconst starkKeyPair0 = ec.getKeyPair(privateKey0);\nconst account0 = new Account(provider, account0Address, starkKeyPair0);\n\n// Declare Test contract in devnet\n// ClassHash has been calculated previously with specific tool\nconst testClassHash = "0xff0378becffa6ad51c67ac968948dbbd110b8a8550397cf17866afebc6c17d";\nconst compiledTest = json.parse(fs.readFileSync("./compiled_contracts/test.json").toString("ascii"));\nconst declareResponse = await account0.declare({ contract: compiledTest, classHash: testClassHash });\n\nawait provider.waitForTransaction(declareResponse.transaction_hash);\nconsole.log(\'\u2705 Test Contract Class Hash =\', declareResponse.class_hash);\n')),(0,o.kt)("p",null,"You can use the ",(0,o.kt)("inlineCode",{parentName:"p"},"declare()")," function for an already declared contract - it will not generate any error."))}u.isMDXComponent=!0},99357:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/createContract-98505be1f3be7f7bbf4cd5089275cde3.png"}}]);