"use strict";(self.webpackChunkwww=self.webpackChunkwww||[]).push([[58477],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>f});var a=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var i=a.createContext({}),l=function(e){var t=a.useContext(i),n=t;return e&&(n="function"==typeof e?e(t):c(c({},t),e)),n},d=function(e){var t=l(e.components);return a.createElement(i.Provider,{value:t},e.children)},u="mdxType",p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},h=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,i=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),u=l(n),h=o,f=u["".concat(i,".").concat(h)]||u[h]||p[h]||r;return n?a.createElement(f,c(c({ref:t},d),{},{components:n})):a.createElement(f,c({ref:t},d))}));function f(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,c=new Array(r);c[0]=h;var s={};for(var i in t)hasOwnProperty.call(t,i)&&(s[i]=t[i]);s.originalType=e,s[u]="string"==typeof e?e:o,c[1]=s;for(var l=2;l<r;l++)c[l]=n[l];return a.createElement.apply(null,c)}return a.createElement.apply(null,n)}h.displayName="MDXCreateElement"},94972:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>i,contentTitle:()=>c,default:()=>p,frontMatter:()=>r,metadata:()=>s,toc:()=>l});var a=n(87462),o=(n(67294),n(3905));const r={sidebar_position:11},c="Work with ERC20 tokens",s={unversionedId:"guides/use_ERC20",id:"version-5.19.5/guides/use_ERC20",title:"Work with ERC20 tokens",description:"Based on what has been seen in the previous pages of this guide, we will use an ERC20 contract.",source:"@site/versioned_docs/version-5.19.5/guides/use_ERC20.md",sourceDirName:"guides",slug:"/guides/use_ERC20",permalink:"/starknet.js/docs/5.19.5/guides/use_ERC20",draft:!1,tags:[],version:"5.19.5",sidebarPosition:11,frontMatter:{sidebar_position:11},sidebar:"defaultSidebar",previous:{title:"Estimate fees",permalink:"/starknet.js/docs/5.19.5/guides/estimate_fees"},next:{title:"Events",permalink:"/starknet.js/docs/5.19.5/guides/events"}},i={},l=[{value:"What&#39;s an ERC20",id:"whats-an-erc20",level:2},{value:"ETH token is an ERC20 in Starknet",id:"eth-token-is-an-erc20-in-starknet",level:2},{value:"Deploy an ERC20",id:"deploy-an-erc20",level:2},{value:"Interact with an ERC20",id:"interact-with-an-erc20",level:2}],d={toc:l},u="wrapper";function p(e){let{components:t,...r}=e;return(0,o.kt)(u,(0,a.Z)({},d,r,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"work-with-erc20-tokens"},"Work with ERC20 tokens"),(0,o.kt)("p",null,"Based on what has been seen in the previous pages of this guide, we will use an ERC20 contract."),(0,o.kt)("h2",{id:"whats-an-erc20"},"What's an ERC20"),(0,o.kt)("p",null,"As in Ethereum, a token has an ERC20 contract to manage it. This contract contains a table, that lists the quantity of tokens owned by each involved account:\n",(0,o.kt)("img",{src:n(75603).Z,width:"788",height:"679"})),(0,o.kt)("p",null,"For example, Account address 2 owns 100 tokens of this ERC20 contract."),(0,o.kt)("p",null,"Users have the feeling that their tokens are stored in their wallets, but it's absolutely false. You have no list of assets stored in your account contract. In fact, a token has its own ERC20 contract, and the amount of token owned by your account address is stored in this contract."),(0,o.kt)("p",null,"If you want to have your balance of a token, ask for its ERC20 contract, with the function ",(0,o.kt)("inlineCode",{parentName:"p"},"ERC20contract.balanceOf(accountAddress)"),"."),(0,o.kt)("p",null,"When you want to transfer some tokens in your possession, you have to use the ERC20 contract function ",(0,o.kt)("inlineCode",{parentName:"p"},"transfer"),", through the ",(0,o.kt)("inlineCode",{parentName:"p"},"account.execute")," function (or meta-class methods). In this way, Starknet.js will send to the account contract a message signed with the private key."),(0,o.kt)("p",null,"This message contains the name of the function to call in the ERC20 contract, with its optional parameters."),(0,o.kt)("p",null,"The account contract will use the public key to check that you have the private key, then will ask the ERC20 contract to execute the requested function."),(0,o.kt)("p",null,"This way, the ERC20 contract is absolutely sure that the caller of the transfer function knows the private key of this account."),(0,o.kt)("h2",{id:"eth-token-is-an-erc20-in-starknet"},"ETH token is an ERC20 in Starknet"),(0,o.kt)("p",null,"In opposition to Ethereum, the ETH token is an ERC20 in Starknet, like all other tokens. In all networks, its ERC20 contract address is:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-typescript"},'const addrETH = "0x049d36570d4e46f48e99674bd3fcc84644ddd6b96f7c741b1562b82f9e004dc7";\n')),(0,o.kt)("h2",{id:"deploy-an-erc20"},"Deploy an ERC20"),(0,o.kt)("p",null,"Let's dive down the rabbit hole!"),(0,o.kt)("p",null,"This example works with an ERC20 mintable (everybody can mint new tokens), that we will deploy on the devnet (launched with ",(0,o.kt)("inlineCode",{parentName:"p"},"starknet-devnet --seed 0"),")."),(0,o.kt)("p",null,"First, let's initialize an account:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-typescript"},'// initialize provider\nconst provider = new Provider({ sequencer: { baseUrl:"http://127.0.0.1:5050"  } });\n// initialize existing pre-deployed account 0 of Devnet\nconst privateKey = "0xe3e70682c2094cac629f6fbed82c07cd";\nconst accountAddress = "0x7e00d496e324876bbc8531f2d9a82bf154d1a04a50218ee74cdd372f75a551a";\n\nconst account0 = new Account(provider, accountAddress, privateKey);\n')),(0,o.kt)("p",null,"Declaration and deployment of the ERC20 contract:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-typescript"},'// Deploy an ERC20 contract\nconsole.log("Deployment Tx - ERC20 Contract to Starknet...");\nconst compiledErc20mintable = json.parse(fs.readFileSync("compiled_contracts/ERC20MintableOZ051.json").toString("ascii"));\n    const initialTk: Uint256 = cairo.uint256(100);\n    const erc20CallData: CallData = new CallData(compiledErc20mintable.abi);\n    const ERC20ConstructorCallData: Calldata = erc20CallData.compile("constructor", {\n        name: "niceToken",\n        symbol: "NIT",\n        decimals: 18,\n        initial_supply: initialTk,\n        recipient: account0.address,\n        owner: account0.address\n    });\n\n    console.log("constructor=", ERC20ConstructorCallData);\n    const deployERC20Response = await account0.declareAndDeploy({\n        contract: compiledErc20mintable,\n        constructorCalldata: ERC20ConstructorCallData\n    });\n    console.log("ERC20 declared hash: ", deployERC20Response.declare.class_hash);\n    console.log("ERC20 deployed at address: ", deployERC20Response.deploy.contract_address);\n\n// Get the erc20 contract address\nconst erc20Address = deployERC20Response.deploy.contract_address;\n// Create a new erc20 contract object\nconst erc20 = new Contract(compiledErc20mintable.abi, erc20Address, provider);\nerc20.connect(account0);\n')),(0,o.kt)("h2",{id:"interact-with-an-erc20"},"Interact with an ERC20"),(0,o.kt)("p",null,"Here we will read the balance, mint new tokens, and transfer tokens:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-typescript"},'// Check balance - should be 100\nconsole.log(`Calling Starknet for account balance...`);\nconst balanceInitial = await erc20.balanceOf(account0.address);\nconsole.log("account0 has a balance of:", uint256.uint256ToBN(balanceInitial.balance).toString()); // Cairo 0 response\n\n// Mint 1000 tokens to account address\nconst amountToMint = cairo.uint256(1000);\nconsole.log("Invoke Tx - Minting 1000 tokens to account0...");\nconst { transaction_hash: mintTxHash } = await erc20.mint(\n    account0.address,\n    amountToMint,\n    { maxFee: 900_000_000_000_000 }\n);\n\n// Wait for the invoke transaction to be accepted on Starknet\nconsole.log(`Waiting for Tx to be Accepted on Starknet - Minting...`);\nawait provider.waitForTransaction(mintTxHash);\n\n// Check balance - should be 1100\nconsole.log(`Calling Starknet for account balance...`);\nconst balanceBeforeTransfer = await erc20.balanceOf(account0.address);\nconsole.log("account0 has a balance of:", uint256.uint256ToBN(balanceBeforeTransfer.balance).toString()); // Cairo 0 response\n\n// Execute tx transfer of 10 tokens\nconsole.log(`Invoke Tx - Transfer 10 tokens back to erc20 contract...`);\nconst toTransferTk: Uint256 = cairo.uint256(10);\nconst transferCallData: Call = erc20.populate("transfer", {\n    recipient: erc20Address,\n    amount: toTransferTk // with Cairo 1 contract, \'toTransferTk\' can be replaced by \'10n\'\n});\n    const { transaction_hash: transferTxHash } = await erc20.transfer( transferCallData.calldata);\n\n// Wait for the invoke transaction to be accepted on Starknet\nconsole.log(`Waiting for Tx to be Accepted on Starknet - Transfer...`);\nawait provider.waitForTransaction(transferTxHash);\n\n// Check balance after transfer - should be 1090\nconsole.log(`Calling Starknet for account balance...`);\nconst balanceAfterTransfer = await erc20.balanceOf(account0.address);\nconsole.log("account0 has a balance of:", uint256.uint256ToBN(balanceAfterTransfer.balance).toString()); // Cairo 0 response\nconsole.log("\u2705 Script completed.");\n')))}p.isMDXComponent=!0},75603:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/ERC20-125d7b5f042b684a588346bc82804b43.png"}}]);